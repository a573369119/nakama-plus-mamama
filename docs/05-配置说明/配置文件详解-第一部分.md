# 配置文件详解 - 第一部分

## 配置文件概述

Nakama-plus使用YAML格式的配置文件，支持丰富的配置选项来定制服务器行为。主要配置文件包括：

- `config.yml` - 主配置文件
- `cluster-config.yml` - 集群专用配置  
- `prometheus.yml` - 监控配置
- `nginx.conf` - 负载均衡配置

## 主配置文件 (config.yml)

### 基本配置节
```yaml
# 节点基本配置
name: "nakama-node-1"  # 节点名称，集群中必须唯一
data_dir: "/nakama/data"  # 数据目录路径

# 运行模式
mode: "production"  # 可选: production, development, test
```

### 数据库配置
```yaml
# 数据库连接配置
database:
  # 数据库地址，支持多个地址实现高可用
  addresses: ["cockroachdb:26257"]
  # 数据库名称
  database: "nakama"
  # 用户名（如果启用认证）
  username: "root"
  # 密码（如果启用认证）
  password: ""
  # 连接参数
  conn_max_lifetime: "1h"  # 连接最大存活时间
  max_open_conns: 100  # 最大打开连接数
  max_idle_conns: 20   # 最大空闲连接数
```

### 会话配置
```yaml
# 用户会话管理
session:
  # 会话令牌过期时间（秒）
  token_expiry_sec: 86400  # 24小时
  # 刷新令牌过期时间（秒）
  refresh_token_expiry_sec: 2592000  # 30天
  # 加密密钥（必须设置）
  encryption_key: "defaultencryptionkey"
  # JWT签名密钥（必须设置）
  signing_key: "defaultsigningkey"
```

### 服务器配置
```yaml
# 服务器监听配置
server:
  # gRPC API端口
  grpc_port: 7349
  # HTTP API端口  
  http_port: 7350
  # 控制台端口
  console_port: 7351
  # 绑定地址
  address: "0.0.0.0"  # 监听所有地址
  
  # SSL/TLS配置
  ssl:
    enabled: false  # 是否启用SSL
    certificate_file: ""  # 证书文件路径
    private_key_file: ""  # 私钥文件路径
    
  # CORS配置
  cors:
    enabled: true  # 启用跨域请求
    allow_origins: ["*"]  # 允许的源
    allow_headers: ["*"]  # 允许的头部
    allow_methods: ["GET", "POST", "PUT", "DELETE"]  # 允许的方法
```

### 运行时配置
```yaml
# Lua运行时配置
runtime:
  # HTTP调用密钥（用于API认证）
  http_key: "defaulthttpkey"
  # 环境变量
  env: []
  # 模块路径
  path: "/nakama/data/modules"
  
  # JavaScript运行时（如果启用）
  js:
    enabled: false
    max_count: 100  # 最大实例数
```

### 日志配置
```yaml
# 日志系统配置
logger:
  # 日志级别: debug, info, warn, error
  level: "info"
  # 日志格式: json, console
  format: "json"
  # 输出文件（空表示标准输出）
  file: ""
  # 是否启用调用者信息
  with_caller: true
  # 是否启用堆栈跟踪
  with_stacktrace: false
```

### 匹配配置
```yaml
# 匹配系统配置
match:
  # 匹配器调用间隔
  call_interval_ms: 1000
  # 最大匹配器数量
  max_count: 10000
  # 匹配器输入队列大小
  input_queue_size: 100
```

### 集群配置
```yaml
# 集群功能配置
cluster:
  # 是否启用集群模式
  enabled: false
  # 节点发现配置
  discovery:
    # 发现类型: etcd, static, dns
    type: "etcd"
    # etcd配置（如果使用etcd）
    etcd:
      endpoints: ["etcd1:2379", "etcd2:2379", "etcd3:2379"]
      dial_timeout: "5s"
      
  # 负载均衡配置
  load_balancer:
    # 负载均衡类型: nginx, haproxy, traefik
    type: "nginx"
    # 策略: round_robin, least_conn, ip_hash
    strategy: "least_conn"
```

[继续阅读第二部分：集群专用配置和监控配置]